{% extends "richie/fullwidth.html" %}
{% load cms_tags i18n %}

{% comment %}{% block meta-keywords %}{{ request.current_page.get_title|lower }} + comma separated list of children{% endblock %}{% endcomment %}

{% block meta_opengraph %}
    <meta property="og:title" content="{{ request.current_page.get_title|truncatechars:65 }}">
    <meta property="og:url" content="{{ SITE.web_url }}{{ request.current_page.get_absolute_url }}">
    <meta property="og:locale" content="{{ LANGUAGE_CODE }}">
    <meta property="og:site_name" content="{{ SITE.name }}">
    {% comment %}<meta property="og:type" content="???">{% endcomment %}
    {% comment %}<meta property="og:image" content="Should be filled from logo url">{% endcomment %}
    {% comment %}<meta property="og:description" content="Should be filled from description, limited to 300char and HTML stripped">{% endcomment %}
{% endblock meta_opengraph %}

{% block content %}{% spaceless %}
{% with category=current_page.category header_level=2 %}
<div class="category-detail">
  <div class="category-detail__banner">
    {% placeholder "banner" or %}
      <div class="category-detail__banner__empty">{% trans "Banner" %}</div>
    {% endplaceholder %}
  </div>

  <div class="category-detail__logo">
    {% with width=216 height=120 %}
      {% placeholder "logo" or %}
        <div class="category-detail__logo__empty">{% trans "Logo" %}</div>
      {% endplaceholder %}
    {% endwith %}
  </div>

  <h1 class="category-detail__title">{% render_model request.current_page "title" %}</h1>

  <div class="category-detail__content">
    <div class="category-detail__content__description">
      {% placeholder "description" %}
    </div>
  </div>
</div>

{% with courses=category.get_courses %}
  {% if courses %}
  <div class="course-glimpse-list">
    <h2 class="course-glimpse-list__title">{% trans "Related courses" %}</h2>
    {% for course in courses %}
      {% if course.extended_object.publisher_is_draft %}
        <a class="course-glimpse course-glimpse--link course-glimpse--draft" href="{{ course.extended_object.get_absolute_url }}">
          {% include "courses/cms/fragment_course_glimpse.html" %}
        </a>
      {% elif course.check_publication %}
        <a class="course-glimpse course-glimpse--link" href="{{ course.extended_object.get_absolute_url }}">
          {% include "courses/cms/fragment_course_glimpse.html" %}
        </a>
      {% endif %}
    {% endfor %}
    </div>
  {% endif %}
{% endwith %}

{% with blogposts=category.get_blogposts %}
  {% if blogposts %}
  <div class="blogpost-glimpse-list">
    <h2 class="blogpost-glimpse-list__title">{% trans "Related blogposts" %}</h2>
    {% for blogpost in blogposts %}
      {% if blogpost.extended_object.publisher_is_draft %}
        <a class="blogpost-glimpse blogpost-glimpse--link blogpost-glimpse--draft" href="{{ blogpost.extended_object.get_absolute_url }}">
          {% include "courses/cms/fragment_blogpost_glimpse.html" %}
        </a>
      {% elif blogpost.check_publication %}
        <a class="blogpost-glimpse blogpost-glimpse--link" href="{{ blogpost.extended_object.get_absolute_url }}">
          {% include "courses/cms/fragment_blogpost_glimpse.html" %}
        </a>
      {% endif %}
    {% endfor %}
    </div>
  {% endif %}
{% endwith %}

{% with persons=category.get_persons %}
  {% if persons %}
  <div class="person-glimpse-list">
    <h2 class="person-glimpse-list__title">{% trans "Related persons" %}</h2>
    {% for person in persons %}
      {% if person.extended_object.publisher_is_draft %}
        {% include "courses/cms/fragment_person_glimpse.html" %}
      {% elif person.check_publication %}
        {% include "courses/cms/fragment_person_glimpse.html" %}
      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
{% endwith %}

{% endwith %}
{% endspaceless %}{% endblock content %}
